[{"content":"8 ç»ˆç«¯å’Œè¿›ç¨‹ç»„ã€unix shell 13 å¤šçº¿ç¨‹ç¼–ç¨‹å…¥é—¨ \u0026hellip;spawnåï¼Œå…±äº«å†…å­˜ä¸å˜ï¼Œæ–°å¢æ–°çš„æ ˆå¸§\nå¹¶å‘vså¹¶è¡Œ\nè¯æ˜äº†å…¨å±€å˜é‡æ˜¯å…±äº«çš„ã€è¯æ˜æ ˆçš„å¤§å°ï¼ˆä¸æ–­é€’å½’ä½¿ç”¨æ ˆç©ºé—´ï¼‰\nå¤šçº¿ç¨‹æ‰“ç ´äº†ç¡®å®šæ€§ -\u0026gt; ç»å…¸çš„å¹¶å‘æ”¯ä»˜ã€å¹¶å‘sum++\nä¸€ä¸ªå°é¢˜ç›®ï¼šå¹¶å‘æ‰§è¡Œä¸‰ä¸ªsum. ,sumçš„æœ€å°å€¼\nt1 t2 t3 t = 0ï¼Œæ­£å¸¸æ‰§è¡Œ++å’Œstoreï¼Œåˆ™sum=2 t=0, t+=1,t=1 t=0, t+=1,t=1 å†åŠ ä¸€æ¬¡å¹¶storeï¼Œåˆ™sum=2 storeï¼Œ sum = 1 store, sum =1 æ­¤æ—¶loadå‡ºsum =1ï¼ˆè¢«å¦å¤–ä¸¤ä¸ªçº¿ç¨‹è¦†ç›–äº†ï¼‰ loadåï¼Œt=1ï¼Œå†++ loadåï¼Œt=1ï¼Œå†++ æ­£å¸¸storeï¼Œå†loadï¼Œå†+1ï¼Œå†æ­£å¸¸storeåï¼Œsum=3 æ­£å¸¸storeï¼Œå†loadï¼Œå†+1ï¼Œå†æ­£å¸¸storeåï¼Œsum=3 å†è¿›è¡Œ++ï¼Œt=2ï¼Œå†loadï¼Œäºæ˜¯sumæœ€ç»ˆä¸º2 ç¼–è¯‘å™¨ä¼šä¼˜åŒ–ç¨‹åº ç¼–è¯‘å™¨å‡è®¾ï¼Œæ²¡æœ‰ä»€ä¹ˆä¼šéšæ„æ›´æ”¹ç¨‹åºçŠ¶æ€ï¼Œé‚£ä¹ˆåªè¦ä¼˜åŒ–å‰åçš„ç¨‹åºï¼Œåœ¨ç¨‹åºè°ƒç”¨å±‚é¢ä¸Šç­‰ä»·ï¼Œé‚£ä¹ˆè¯­å¥å…¶å®æ˜¯å¯ä»¥éšæ„è°ƒæ¢åˆ é™¤çš„\né‚£ä¹ˆç¼–å†™ç¨‹åºæ—¶ï¼Œå¤§éƒ¨åˆ†æ—¶å€™å¸Œæœ›ç¼–è¯‘å™¨ä¼˜åŒ–çš„ï¼Œæ¯•ç«Ÿéœ€è¦æ€§èƒ½ï¼Œé‚£ä¹ˆæœ‰ä¸¤ä¸ªä¸æ¨èçš„è·¯å­ï¼š1.æ’å…¥ä¸å¯ä¼˜åŒ–çš„ä»£ç å—ã€‚2.ä½¿ç”¨volatileå…³é”®å­—\nå†µä¸”å†…å­˜ä¹Ÿä¸æ˜¯çœŸçš„shardedçš„ï¼Œç”±äºç‰©ç†ä¸Šçš„è·ç¦»ã€è¯»å†™çš„é€Ÿåº¦ï¼ŒAçº¿ç¨‹ä¸Šçš„å†…å­˜å’ŒBçº¿ç¨‹ä¸Šçš„å†…å­˜æ˜¯å¾ˆæœ‰å¯èƒ½ä¸ä¸€è‡´çš„ï¼ˆå› ä¸ºä¸ºäº†ä¿è¯å¿«ï¼Œæ“ä½œç³»ç»Ÿè¯»å–æ—¶ï¼Œæ˜¯ç«‹é©¬è¿”å›çš„ï¼Œè€Œä¸æ˜¯åƒå…¶ä»–å†…å­˜å—ç¡®è®¤æ˜¯å¦æœ‰ä¿®æ”¹ï¼‰\n","date":"2025-05-16T00:00:00Z","permalink":"http://localhost:1313/p/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%8D%97%E4%BA%AC%E5%A4%A7%E5%AD%A6%E8%92%8B%E7%82%8E%E7%82%8E--%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","title":"æ“ä½œç³»ç»Ÿï¼ˆå—äº¬å¤§å­¦è’‹ç‚ç‚ï¼‰--ä¸ªäººå­¦ä¹ ç¬”è®°"},{"content":"å‰è¨€ ç¬”è€…æœ‰ä¸¤å¹´Javaå¼€å‘ç»éªŒï¼Œç›®å‰éœ€è¦ä¸´æ—¶ç”¨goè¯­è¨€å¼€å‘ä¸€äº›åŠŸèƒ½ï¼Œä¸ºäº†å¿«é€Ÿå…¥æ‰‹Goè¯­è¨€ï¼Œåœ¨ç®€å•äº†è§£åŸºç¡€è¯­æ³•åï¼Œå†³å®šä»¥å®æˆ˜æ¥å·©å›ºçŸ¥è¯†ã€‚\nå‚è€ƒäº†ã€ŠRuståœ£ç»ã€‹çš„æ€è·¯ï¼Œå†³å®šå…ˆå¼€å‘ä¸€ä¸ªæ¨¡ä»¿grepçš„å·¥å…·ï¼Œæ¥å¿«é€Ÿå·©å›ºåŸºç¡€è¯­æ³•ã€Goé¡¹ç›®ç®¡ç†ã€‚\nä¸ºç²¾ç®€å†…å®¹ï¼Œæœ¬ç³»åˆ—ä¸åŒ…å«ç¯å¢ƒæ­å»ºç­‰åŸºç¡€éƒ¨åˆ†ï¼ˆç½‘ä¸Šæ•™ç¨‹å†™çš„æ›´æ¸…æ¥šè¯¦ç»†ï¼‰ï¼Œç›´æ¥è®²è§£å¼€å‘æ€è·¯ã€‚å¸Œæœ›èƒ½å¯¹åæ¥è€…æä¾›ä¸€äº›å…¥é—¨æ€è·¯ã€‚\nç¬”è€…æ•´ä½“æ€è·¯ï¼šå¤§è‡´äº†è§£goè¯­è¨€çš„è¯­æ³•ï¼Œäº†è§£æŸä¸ªå·¥å…·çš„å¤§è‡´åŠŸèƒ½ã€å®ç°æ–¹æ³•ã€‚ç„¶åå†è¾…ä»¥AIè¯­æ³•æç¤ºï¼ˆä»…ä»…å‘Šè¯‰æŸä¸ªç»†èŠ‚ï¼Œæ¯”å¦‚å¦‚ä½•è¯»å–å‚æ•°ç­‰ï¼Œè€Œä¸æ˜¯ç›´æ¥è®©aiå®ç°åŠŸèƒ½ï¼‰ã€‚è¿™æ ·ä¾¿èƒ½å¿«é€Ÿå…¥é—¨ä¸€ä¸ªä¸ç®—å¤æ‚çš„è¯­è¨€ã€‚\nPSï¼šä»£ç ä»“åº“: https://github.com/FarSightLi/minigrep\næ­£æ–‡ åŠŸèƒ½æ‹“å±• åœ¨ä¸Šä¸€ç¯‡ä¸­ï¼Œæˆ‘ä»¬åˆæ­¥å®Œæˆäº†ä¸€ä¸ªåŠå…¶ç®€é™‹çš„grepç¨‹åºï¼Œåœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†é€æ­¥æ‹“å±•åŠŸèƒ½ã€‚\nåœ¨ç¬”è€…æ—¥å¸¸å·¥ä½œä¸­ï¼Œ-An(åŒ¹é…åˆ—çš„ä¸‹nè¡Œ)ï¼Œ -anï¼ˆåŒ¹é…åˆ—çš„ä¸Šä¸‹nè¡Œï¼‰ã€-Bnï¼ˆåŒ¹é…åˆ—çš„ä¸Šnè¡Œï¼‰ã€-nï¼ˆæ˜¾ç¤ºè¡Œå·ï¼‰ã€-iï¼ˆå¿½ç•¥å¤§å°å†™ï¼‰ã€-eï¼ˆå¯ç”¨æ­£åˆ™åŒ¹é…ï¼‰ã€‚åœ¨è¿™ç¯‡ä¸­ï¼Œæˆ‘ä»¬å°±æ‹“å±•è¿™å‡ ç§å‚æ•°åŠŸèƒ½ã€‚\nä¼˜åŒ–å‚æ•°è·å– åœ¨ä¸Šä¸€ç¯‡çš„åŸå§‹ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™ç§ æ–¹å¼è·å¾—æ–‡ä»¶è·¯å¾„å’Œæœç´¢æ–‡æœ¬ã€‚è¿™ä¸¤ä¸ªå‚æ•°å¯ä»¥è¢«è§†ä¸ºâ€å¿…é¡»å‚æ•°â€œï¼ˆè™½ç„¶filepathä¸ä¸€å®šå¿…é¡»ï¼Œå¯ä»¥ä»è¾“å…¥æµä¸­è·å–ï¼Œå½“ç„¶è¿™æ˜¯åè¯äº†ï¼‰ã€‚è€Œåˆšåˆšæåˆ°çš„è¯¸å¦‚ -aç­‰å‚æ•°å´å¯ä»¥ä½¿ç”¨ä»»æ„ä¸ªã€‚æ‰€ä»¥æˆ‘ä»¬é€šè¿‡ä»æ•°ç»„argsçš„æŒ‡å®šä½ç½®è·å–çš„æ–¹æ³•å°±ä¸é€‚ç”¨äº†ã€‚è¿™ç§å‚æ•°ç§°ä¹‹ä¸ºé€‰é¡¹å‚æ•°\n1 2 filepath = args[1] searchText = args[2] åœ¨golangä¸­ï¼Œé€‰é¡¹å‚æ•°å¯ä»¥ç”¨goçš„å‡½æ•°flag.CommandLine.Parse(args[1:])è·å–\nä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š\n1 2 3 4 5 // é€‰é¡¹å‚æ•°ç”¨flagè§£æ isIgnoreCase := flag.Bool(\u0026#34;i\u0026#34;, false, \u0026#34;ignore case\u0026#34;) around := flag.Int(\u0026#34;a\u0026#34;, 0, \u0026#34;around line\u0026#34;) isIncludeLineNumber := flag.Bool(\u0026#34;n\u0026#34;, false, \u0026#34;include line number\u0026#34;) err := flag.CommandLine.Parse(args[1:]) éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œflag.Intè·å¾—çš„æ˜¯æŒ‡é’ˆç±»å‹\nargsä»1å·ä½åˆ‡ç‰‡æ˜¯å› ä¸º0å·ä½æ˜¯æˆ‘ä»¬çš„ç¨‹åºå\nä½¿ç”¨æ—¶ï¼Œè¿™äº›é€‰é¡¹å‚æ•°å¦‚è¿™æ ·ä½¿ç”¨ï¼š\n1 go run main.go -i -a 2 -n #{æ–‡ä»¶è·¯å¾„} #{æœç´¢å†…å®¹} ç»“æ„ä½“ è™½ç„¶golangçš„æ–¹æ³•å¯ä»¥æ‹¥æœ‰å¤šä¸ªè¿”å›å€¼ï¼Œä½†æ˜¯è§£æå®Œçš„å¤šä¸ªå‚æ•°å¹¶ä¸é€‚åˆç›´æ¥è¿”å›ï¼Œå¯ä»¥ç”¨ç»“æ„ä½“åŒ…è£…åè¿”å›\nç»“æ„ä½“å¤§è‡´å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 type cmdArgs struct { filepath string searchText string isIgnoreCase bool isIncludeLineNumber bool afterLine int beforeLine int aroundLine int } å®ç°æ€è·¯ å¯ä»¥å‘ç°ï¼Œè¿™äº›å‚æ•°ä¸­ï¼Œ-iã€-eç­‰é€‰é¡¹æ˜¯ç”¨äºå†³å®šå¦‚ä½•åŒ¹é…æ–‡æœ¬çš„ï¼Œè€Œ-a -nç­‰å‚æ•°å®åˆ™æ˜¯æ§åˆ¶è¾“å‡ºçš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å…¶æŠ½è±¡ä¸ºä¸¤ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªç”¨äºåœ¨éå†æ¯è¡Œå†…å®¹æ—¶åŒ¹é…æ–‡æœ¬ï¼Œå¦ä¸€ä¸ªç”¨äºåœ¨åŒ¹é…åè¾“å‡ºå†…å®¹\næ ¸å¿ƒä»£ç å¤§è‡´å®ç°å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 /** * æœç´¢æ–‡ä»¶å¹¶æ‰“å°å†…å®¹ */ func searchFile(content string, cmdArgs cmdArgs) { if content == \u0026#34;\u0026#34; { return } searchText := cmdArgs.searchText // æå‰ç¼–è¯‘æ­£åˆ™ compile, err := regexp.Compile(searchText) if err != nil { _, _ = fmt.Fprintf(os.Stderr, \u0026#34;éæ³•çš„æ­£åˆ™è¡¨è¾¾å¼: %v\\n\u0026#34;, err) return } lines := strings.Split(content, \u0026#34;\\n\u0026#34;) for lineNum, line := range lines { // ä½¿ç”¨æ­£åˆ™æ¨¡å¼ if cmdArgs.useRegex { if compile.MatchString(line) { printLine(cmdArgs, lines, lineNum) } } else { if cmdArgs.isIgnoreCase { searchText = strings.ToLower(cmdArgs.searchText) line = strings.ToLower(line) } if strings.Contains(line, searchText) { printLine(cmdArgs, lines, lineNum) } } } } /** * æ ¹æ®å‚æ•°æ‰“å°åŒ¹é…ä¸Šçš„è¡Œ */ func printLine(cmdArgs cmdArgs, lines []string, lineNum int) { var a, b int if cmdArgs.aroundLine \u0026gt; 0 { a = cmdArgs.aroundLine b = cmdArgs.aroundLine } else { a = cmdArgs.afterLine b = cmdArgs.beforeLine } start := lineNum - a if start \u0026lt; 0 { start = 0 } end := lineNum + b length := len(lines) if end \u0026gt;= length { end = length - 1 } for index := start; index \u0026lt;= end; index++ { if cmdArgs.isIncludeLineNumber { fmt.Printf(\u0026#34;%d:%s\\n\u0026#34;, index, lines[index]) } else { fmt.Println(lines[index]) } } } å•å…ƒæµ‹è¯• ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼ŒåŒ¹é…è¡Œåä¸å†ç›´æ¥è¾“å‡ºï¼Œè€Œæ˜¯è¿”å›æ•°ç»„ï¼Œæœ€ååŒæ„è¾“å‡ºï¼ˆç”±AIç”Ÿæˆï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 func TestMatchLines(t *testing.T) { tests := []struct { name string content string cmdArgs cmdArgs expected []string }{ { name: \u0026#34;æ™®é€šåŒ¹é…\u0026#34;, content: \u0026#34;apple banana\\ncherry apple\\ndate\u0026#34;, cmdArgs: cmdArgs{ searchText: \u0026#34;apple\u0026#34;, }, expected: []string{\u0026#34;apple banana\u0026#34;, \u0026#34;cherry apple\u0026#34;}, }, { name: \u0026#34;å¿½ç•¥å¤§å°å†™\u0026#34;, content: \u0026#34;Apple banana\\nCHERRY APPLE\u0026#34;, cmdArgs: cmdArgs{ searchText: \u0026#34;apple\u0026#34;, isIgnoreCase: true, }, expected: []string{\u0026#34;Apple banana\u0026#34;, \u0026#34;CHERRY APPLE\u0026#34;}, }, { name: \u0026#34;æ­£åˆ™åŒ¹é…ä»¥ a å¼€å¤´\u0026#34;, content: \u0026#34;apple banana\\ngrape apple\\nant\u0026#34;, cmdArgs: cmdArgs{ searchText: \u0026#34;^[aA]\u0026#34;, useRegex: true, }, expected: []string{\u0026#34;apple banana\u0026#34;, \u0026#34;ant\u0026#34;}, }, { name: \u0026#34;ä¸Šä¸‹æ–‡ä¸¤è¡Œ\u0026#34;, content: \u0026#34;line1\\nline2\\napple\\nline4\\nline5\u0026#34;, cmdArgs: cmdArgs{ searchText: \u0026#34;apple\u0026#34;, aroundLine: 2, }, expected: []string{\u0026#34;line1\u0026#34;, \u0026#34;line2\u0026#34;, \u0026#34;apple\u0026#34;, \u0026#34;line4\u0026#34;, \u0026#34;line5\u0026#34;}, }, { name: \u0026#34;æ˜¾ç¤ºè¡Œå·\u0026#34;, content: \u0026#34;hello\\nworld\\nhello again\u0026#34;, cmdArgs: cmdArgs{ searchText: \u0026#34;hello\u0026#34;, isIncludeLineNumber: true, }, expected: []string{\u0026#34;0:hello\u0026#34;, \u0026#34;2:hello again\u0026#34;}, }, } for _, tt := range tests { t.Run(tt.name, func(t *testing.T) { results := MatchLines(tt.content, tt.cmdArgs, make(map[int]struct{})) if len(results) != len(tt.expected) { t.Errorf(\u0026#34;é¢„æœŸ %d è¡Œï¼Œå®é™… %d è¡Œ\u0026#34;, len(tt.expected), len(results)) return } for i := range results { if results[i] != tt.expected[i] { t.Errorf(\u0026#34;ç¬¬ %d è¡ŒæœŸæœ› %qï¼Œå®é™… %q\u0026#34;, i, tt.expected[i], results[i]) } } }) } } ä»£ç å…¨æ–‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 package main import ( \u0026#34;errors\u0026#34; \u0026#34;flag\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;os\u0026#34; \u0026#34;regexp\u0026#34; \u0026#34;strings\u0026#34; ) func main() { args := os.Args cmdArgs, err := parseArgs(args) if err != nil { fmt.Println(err) return } content := \u0026#34;\u0026#34; // ä»è¾“å…¥æµä¸­è¯»å– if cmdArgs.filepath == \u0026#34;\u0026#34; { bytes, err := io.ReadAll(os.Stdin) if err != nil { fmt.Println(\u0026#34;è¯»å–è¾“å…¥æµå‡ºé”™\u0026#34;) return } content = string(bytes) } else { contentByte, e := readFile(cmdArgs.filepath) if e != nil { fmt.Println(e) return } content = contentByte } var printedLine = make(map[int]struct{}) line := MatchLines(content, cmdArgs, printedLine) for _, s := range line { fmt.Println(s) } } type cmdArgs struct { filepath string searchText string isIgnoreCase bool isIncludeLineNumber bool afterLine int beforeLine int aroundLine int useRegex bool } /** * è§£æå‘½ä»¤è¡Œå‚æ•° */ func parseArgs(args []string) (cmdArgs, error) { // é€‰é¡¹å‚æ•°ç”¨flagè§£æ isIgnoreCase := flag.Bool(\u0026#34;i\u0026#34;, false, \u0026#34;ignore case\u0026#34;) around := flag.Int(\u0026#34;a\u0026#34;, 0, \u0026#34;around line\u0026#34;) before := flag.Int(\u0026#34;B\u0026#34;, 0, \u0026#34;before line\u0026#34;) after := flag.Int(\u0026#34;A\u0026#34;, 0, \u0026#34;after line\u0026#34;) isIncludeLineNumber := flag.Bool(\u0026#34;n\u0026#34;, false, \u0026#34;include line number\u0026#34;) useRegex := flag.Bool(\u0026#34;e\u0026#34;, false, \u0026#34;use regex module\u0026#34;) err := flag.CommandLine.Parse(args[1:]) if err != nil { return cmdArgs{}, err } // éé€‰é¡¹å‚æ•°ç”¨æ™®é€šæ–¹å¼è§£æ nonFlagArgs := flag.Args() // åªåŒ…å«äº†æœç´¢å†…å®¹ var searchText string var filepath string if len(nonFlagArgs) == 1 { filepath = \u0026#34;\u0026#34; searchText = nonFlagArgs[0] } else if len(nonFlagArgs) == 2 { filepath = nonFlagArgs[0] searchText = nonFlagArgs[1] } else { return cmdArgs{}, errors.New(\u0026#34;å‚æ•°é”™è¯¯,æ ‡å‡†å‚æ•°åªå…è®¸æœ‰æ–‡ä»¶è·¯å¾„å’Œæœç´¢å†…å®¹\u0026#34;) } return cmdArgs{filepath, searchText, *isIgnoreCase, *isIncludeLineNumber, *after, *before, *around, *useRegex}, nil } /** * æœç´¢æ–‡ä»¶å¹¶æ‰“å°å†…å®¹ */ func MatchLines(content string, cmdArgs cmdArgs, printedLine map[int]struct{}) []string { if content == \u0026#34;\u0026#34; { return []string{} } searchText := cmdArgs.searchText // æå‰ç¼–è¯‘æ­£åˆ™ var compile *regexp.Regexp if cmdArgs.useRegex { c, err := regexp.Compile(searchText) if err != nil { _, _ = fmt.Fprintf(os.Stderr, \u0026#34;éæ³•çš„æ­£åˆ™è¡¨è¾¾å¼: %v\\n\u0026#34;, err) return []string{} } compile = c } var matchedLines []string lines := strings.Split(content, \u0026#34;\\n\u0026#34;) for lineNum, line := range lines { // ä½¿ç”¨æ­£åˆ™æ¨¡å¼ if cmdArgs.useRegex { if compile.MatchString(line) { matchedLines = append(matchedLines, formatLine(cmdArgs, lines, lineNum, printedLine)...) } } else { if cmdArgs.isIgnoreCase { searchText = strings.ToLower(cmdArgs.searchText) line = strings.ToLower(line) } if strings.Contains(line, searchText) { matchedLines = append(matchedLines, formatLine(cmdArgs, lines, lineNum, printedLine)...) } } } return matchedLines } /** * æ ¹æ®å‚æ•°æ‰“å°åŒ¹é…ä¸Šçš„è¡Œ */ func formatLine(cmdArgs cmdArgs, lines []string, lineNum int, printedLine map[int]struct{}) []string { var matchedLines []string var a, b int if cmdArgs.aroundLine \u0026gt; 0 { a = cmdArgs.aroundLine b = cmdArgs.aroundLine } else { a = cmdArgs.afterLine b = cmdArgs.beforeLine } start := lineNum - b if start \u0026lt; 0 { start = 0 } end := lineNum + a length := len(lines) if end \u0026gt;= length { end = length - 1 } for index := start; index \u0026lt;= end; index++ { // å¦‚æœæ‰“å°è¿‡äº†å°±ä¸å†æ‰“å° if _, exist := printedLine[index]; exist { continue } if cmdArgs.isIncludeLineNumber { matchedLines = append(matchedLines, fmt.Sprintf(\u0026#34;%d:%s\u0026#34;, index, lines[index])) } else { matchedLines = append(matchedLines, fmt.Sprintf(lines[index])) } printedLine[index] = struct{}{} } return matchedLines } func readFile(filepath string) (string, error) { // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ info, err := os.Stat(filepath) if os.IsNotExist(err) { return \u0026#34;\u0026#34;, fmt.Errorf(\u0026#34;æ‰¾ä¸åˆ° %s æ–‡ä»¶\u0026#34;, filepath) } // æ£€æŸ¥æ˜¯å¦æ˜¯ç›®å½• if err == nil \u0026amp;\u0026amp; info.IsDir() { return \u0026#34;\u0026#34;, fmt.Errorf(\u0026#34;%s æ˜¯ä¸€ä¸ªç›®å½•è€Œéæ–‡ä»¶\u0026#34;, filepath) } // è¯»å–æ–‡ä»¶å†…å®¹ content, err := os.ReadFile(filepath) if err != nil { if os.IsPermission(err) { return \u0026#34;\u0026#34;, errors.New(\u0026#34;æƒé™è¢«æ‹’ç»\u0026#34;) } return \u0026#34;\u0026#34;, err } return string(content), nil } æ€»ç»“ é€šè¿‡è¿™æ¬¡ä¼˜åŒ–ï¼Œæˆ‘ä»¬ç”¨åˆ°äº†æ›´å¤šgolangçš„ç‰¹æ€§ï¼Œæ¯”å¦‚ç”¨mapæ¨¡æ‹Ÿsetã€è¯»å–å‚æ•°ä¸­çš„é€‰é¡¹å‚æ•°ã€æ­£åˆ™ä½¿ç”¨ ä»¥åŠ æ•°ç»„æ·»åŠ ç­‰ã€‚\nä½†æ˜¯ç¨å¾®æœ‰äº›ç»éªŒçš„è¯»è€…éƒ½èƒ½å‘ç°ä¸€ä¸ªä¸¥é‡é—®é¢˜ ï¼šå†…å­˜å¤§çˆ†ç‚¸\næˆ‘ä»¬çš„è¾“å…¥æµã€ä»æ–‡ä»¶è¯»å‡ºæ¥çš„å†…å®¹éƒ½æ”¾åˆ°äº†å†…å­˜ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸¥é‡éšæ‚£ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç¯‡ä¸­ä¼˜åŒ–æ­¤é¡¹\n","date":"2025-05-01T00:00:00Z","permalink":"http://localhost:1313/p/%E4%BA%94%E5%A4%A9%E9%80%9F%E9%80%9Ago--%E6%90%AD%E5%BB%BAmini-grep%E4%BA%8C/","title":"äº”å¤©é€Ÿé€šgo--æ­å»ºmini-grep(äºŒ)"},{"content":"å‰è¨€ ç¬”è€…æœ‰ä¸¤å¹´Javaå¼€å‘ç»éªŒï¼Œç›®å‰éœ€è¦ä¸´æ—¶ç”¨goè¯­è¨€å¼€å‘ä¸€äº›åŠŸèƒ½ï¼Œä¸ºäº†å¿«é€Ÿå…¥æ‰‹Goè¯­è¨€ï¼Œåœ¨ç®€å•äº†è§£åŸºç¡€è¯­æ³•åï¼Œå†³å®šä»¥å®æˆ˜æ¥å·©å›ºçŸ¥è¯†ã€‚\nå‚è€ƒäº†ã€ŠRuståœ£ç»ã€‹çš„æ€è·¯ï¼Œå†³å®šå…ˆå¼€å‘ä¸€ä¸ªæ¨¡ä»¿grepçš„å·¥å…·ï¼Œæ¥å¿«é€Ÿå·©å›ºåŸºç¡€è¯­æ³•ã€Goé¡¹ç›®ç®¡ç†ã€‚\nä¸ºç²¾ç®€å†…å®¹ï¼Œæœ¬ç³»åˆ—ä¸åŒ…å«ç¯å¢ƒæ­å»ºç­‰åŸºç¡€éƒ¨åˆ†ï¼ˆç½‘ä¸Šæ•™ç¨‹å†™çš„æ›´æ¸…æ¥šè¯¦ç»†ï¼‰ï¼Œç›´æ¥è®²è§£å¼€å‘æ€è·¯ã€‚å¸Œæœ›èƒ½å¯¹åæ¥è€…æä¾›ä¸€äº›å…¥é—¨æ€è·¯ã€‚\nç¬”è€…æ•´ä½“æ€è·¯ï¼šå¤§è‡´äº†è§£goè¯­è¨€çš„è¯­æ³•ï¼Œäº†è§£æŸä¸ªå·¥å…·çš„å¤§è‡´åŠŸèƒ½ã€å®ç°æ–¹æ³•ã€‚ç„¶åå†è¾…ä»¥AIè¯­æ³•æç¤ºï¼ˆä»…ä»…å‘Šè¯‰æŸä¸ªç»†èŠ‚ï¼Œæ¯”å¦‚å¦‚ä½•è¯»å–å‚æ•°ç­‰ï¼Œè€Œä¸æ˜¯ç›´æ¥è®©aiå®ç°åŠŸèƒ½ï¼‰ã€‚è¿™æ ·ä¾¿èƒ½å¿«é€Ÿå…¥é—¨ä¸€ä¸ªä¸ç®—å¤æ‚çš„è¯­è¨€ã€‚\nPSï¼šä»£ç ä»“åº“: GitHub - FarSightLi/minigrep\ngrepå‘½ä»¤ç®€ä»‹ grepæ˜¯ä¸€ä¸ªæœ€åˆç”¨äºUnixæ“ä½œç³»ç»Ÿçš„å‘½ä»¤è¡Œå·¥å…·ã€‚åœ¨ç»™å‡ºæ–‡ä»¶åˆ—è¡¨æˆ–æ ‡å‡†è¾“å…¥åï¼Œgrepä¼šå¯¹åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æ–‡æœ¬è¿›è¡Œæœç´¢ï¼Œå¹¶åªè¾“å‡ºåŒ¹é…ï¼ˆæˆ–è€…ä¸åŒ¹é…ï¼‰çš„è¡Œæˆ–æ–‡æœ¬ã€‚\n\u0026ndash; wikiç™¾ç§‘\ngrepçš„ä¸€ä¸ªç»å…¸ç”¨æ³•æ˜¯ï¼š\n1 grep /data/test.txt searchContent å…¶ä¸­ï¼Œ/data/test.txt æ˜¯è¦æœç´¢çš„æ–‡ä»¶åˆ—è¡¨ï¼Œ searchContentæ˜¯æˆ‘ä»¬è¦æœç´¢çš„å†…å®¹ã€‚è¿™æ˜¯ä¸€ç§æœ€åŸºæœ¬çš„åŠŸèƒ½ã€‚\næ­å»ºåŸºæœ¬æ¡†æ¶ æˆ‘ä»¬çš„minigrepè‡³å°‘è¦å…ˆèƒ½è·å–åˆ°ç”¨æˆ·çš„ç›®æ ‡ :æ–‡ä»¶åˆ—è¡¨åŠæœç´¢å†…å®¹ \u0026ndash; å³å‚æ•°åˆ—è¡¨ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;os\u0026#34; ) func main() { // è¯»å–å‚æ•°åˆ—è¡¨ args := os.Args // æ–‡ä»¶è·¯å¾„ filepath := args[1] // æœç´¢å†…å®¹ searchText := args[2] content, e := os.ReadFile(filepath) if e != nil { panic(\u0026#34;Usage: illegal file name\u0026#34;) } // å‡è£…å·²ç»å®ç°äº†æœç´¢åŠŸèƒ½ fmt.Printf(\u0026#34;search %s for file: %s\\n\u0026#34;, searchText, filepath) fmt.Printf(\u0026#34;file content: %s\\n\u0026#34;, string(content)) } ç°åœ¨æˆ‘ä»¬æ¥è¿è¡Œä¸€ä¸‹ï¼š\n1 2 3 4 5 6 7 8 go run .\\main.go .\\data\\test1.txt è¯­è¨€ search è¯­è¨€ for file: .\\data\\test1.txt file content: Go ç¼–ç¨‹è¯­è¨€æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ—¨åœ¨æé«˜ç¨‹åºå‘˜çš„ç”Ÿäº§åŠ›ã€‚ Go è¡¨è¾¾åŠ›å¼ºã€ç®€æ´ã€å¹²å‡€ä¸”é«˜æ•ˆã€‚ å…¶å¹¶å‘æœºåˆ¶ä½¿ç¼–å†™èƒ½å……åˆ†åˆ©ç”¨å¤šæ ¸å’Œè”ç½‘æœºå™¨çš„ç¨‹åºå˜å¾—å®¹æ˜“ï¼Œè€Œå…¶æ–°é¢–çš„ç±»å‹ç³»ç»Ÿåˆ™æ”¯æŒçµæ´»ä¸”æ¨¡å—åŒ–çš„ç¨‹åºæ„å»ºã€‚ Go å¯å¿«é€Ÿç¼–è¯‘ä¸ºæœºå™¨ä»£ç ï¼Œä½†å…·æœ‰åƒåœ¾å›æ”¶çš„ä¾¿åˆ©æ€§å’Œè¿è¡Œæ—¶åå°„çš„åŠŸèƒ½ã€‚ å®ƒæ˜¯ä¸€ç§å¿«é€Ÿã€é™æ€ç±»å‹ã€ç¼–è¯‘è¯­è¨€ï¼Œä½†æ„Ÿè§‰åƒæ˜¯ä¸€ç§åŠ¨æ€ç±»å‹ã€è§£é‡Šè¯­è¨€ã€‚ ç°åœ¨ä¼šæ‰“å°search è¯­è¨€ for file: .\\data\\test1.txt ä»¥åŠå®Œæ•´çš„æ–‡ä»¶å†…å®¹äº†ï¼Œä½†æ˜¯å‡å¦‚ç”¨æˆ·å¿˜äº†è¾“å…¥ä»–æƒ³è¦åœ¨å“ªä¸ªæ–‡ä»¶ä¸­æœç´¢å‘¢ï¼Ÿ\n1 2 3 4 5 6 7 PS D:\\go-project\\minigrep\u0026gt; go run .\\main.go è¯­è¨€ panic: runtime error: index out of range [2] with length 2 goroutine 1 [running]: main.main() D:/go-project/minigrep/main.go:15 +0x185 exit status 2 oh no, è¿™æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬ä½œä¸ºå¼€å‘äººå‘˜å½“ç„¶èƒ½çœ‹æ‡‚è¿™æ˜¯ä»€ä¹ˆï¼Œä½†æ˜¯æ™®é€šç”¨æˆ·å‘¢ï¼Ÿå› æ­¤æˆ‘ä»¬é™¤äº†éœ€è¦çœŸæ­£å®ç°æœç´¢åŠŸèƒ½ï¼Œè¿˜åº”è¯¥å¯¹è¿™ç§å¼‚å¸¸æƒ…å†µåšå‡ºæ›´å‹å¥½çš„æç¤ºã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„é€»è¾‘éƒ½æ‚ç³…åœ¨mainæ–¹æ³•ä¸­ï¼Œè¿™ä¹Ÿä¸ç¬¦åˆè½¯ä»¶å·¥ç¨‹çš„æœ€ä½³å®è·µã€‚\nåˆæ­¥é‡æ„ï¼Œå®ŒæˆåŠŸèƒ½ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å°†è§£æå‚æ•°ã€è¯»å–æ–‡ä»¶å†…å®¹ã€æœç´¢å†…å®¹è¿™ä¸‰ä¸ªåŠŸèƒ½æ‹†æˆä¸åŒçš„æ¨¡å—ï¼ˆfuncï¼‰ï¼Œæ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¾—é€‚å½“çš„å¤„ç†panicã€‚\nåœ¨javaä¸­ï¼Œæˆ‘ä»¬ä¹ æƒ¯ç”¨try-catchè¯­æ³•æ¥æ•è·å¼‚å¸¸ï¼Œå†ç»™å‡ºåˆç†çš„é”™è¯¯æç¤ºã€‚è™½ç„¶goè¯­è¨€ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„è¯­æ³•ï¼ˆrecoverï¼‰ï¼Œä½†æ˜¯goè¯­è¨€æ›´é¼“åŠ±æ˜¾å¼åœ°å¤„ç†è¿™ç§é¢„æ–™ä¹‹å†…çš„å¼‚å¸¸ï¼ˆå³ç”¨funcè¿”å›çš„erroræ¥åˆ¤æ–­ï¼‰\næ ¹æ®è¿™äº›æ€è·¯ï¼Œæˆ‘ä»¬å†™å‡ºäº†ä¸‹é¢çš„ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;os\u0026#34; \u0026#34;strings\u0026#34; ) func main() { args := os.Args filepath, searchText, err := parseArgs(args) if err != nil { fmt.Println(err) return } content, e := readFile(filepath) if e != nil { fmt.Println(e) return } searchFile(string(content), searchText) } func parseArgs(args []string) (filepath string, searchText string, error error) { if len(args) != 3 { return \u0026#34;\u0026#34;, \u0026#34;\u0026#34;, fmt.Errorf(\u0026#34;illegal arguments, should be filepath and searchText\u0026#34;) } // æ–‡ä»¶è·¯å¾„ filepath = args[1] searchText = args[2] return filepath, searchText, nil } func searchFile(content string, searchText string) { // goä¸­stringç±»å‹çš„ç©ºå€¼æ˜¯\u0026#34;\u0026#34;(ç©ºå­—ç¬¦ä¸²)è€Œä¸æ˜¯nil if content == \u0026#34;\u0026#34; { return } lines := strings.Split(content, \u0026#34;\\n\u0026#34;) for _, line := range lines { if strings.Contains(line, searchText) { fmt.Println(line) } } } func readFile(filepath string) (string, error) { // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ if _, err := os.Stat(filepath); os.IsNotExist(err) { return \u0026#34;\u0026#34;, fmt.Errorf(\u0026#34;file not found\u0026#34;) } // æ£€æŸ¥æ˜¯å¦æ˜¯ç›®å½• info, err := os.Stat(filepath) if err == nil \u0026amp;\u0026amp; info.IsDir() { return \u0026#34;\u0026#34;, fmt.Errorf(\u0026#34;is a directory, not a file\u0026#34;) } // è¯»å–æ–‡ä»¶å†…å®¹ content, err := os.ReadFile(filepath) if err != nil { if os.IsPermission(err) { return \u0026#34;\u0026#34;, fmt.Errorf(\u0026#34;permission denied\u0026#34;) } return \u0026#34;\u0026#34;, err } return string(content), nil } æ·»åŠ å•å…ƒæµ‹è¯• æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€äº›å•å…ƒæµ‹è¯•ï¼Œç”¨ä»¥åˆæ­¥éªŒè¯æˆ‘ä»¬çš„ç¨‹åºæ˜¯å¦æœ‰é”™è¯¯ã€‚ï¼ˆä»¥ä¸‹æµ‹è¯•ä»£ç ç”¨AIç”Ÿæˆï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 package minigrep import ( \u0026#34;io\u0026#34; \u0026#34;os\u0026#34; \u0026#34;strings\u0026#34; \u0026#34;testing\u0026#34; ) // TestParseArgs æµ‹è¯•è§£æå‘½ä»¤è¡Œå‚æ•°çš„åŠŸèƒ½ func TestParseArgs(t *testing.T) { // ä¿å­˜åŸå§‹çš„å‘½ä»¤è¡Œå‚æ•° oldArgs := os.Args defer func() { os.Args = oldArgs }() // æµ‹è¯•æ­£å¸¸æƒ…å†µ os.Args = []string{\u0026#34;minigrep\u0026#34;, \u0026#34;test.txt\u0026#34;, \u0026#34;hello\u0026#34;} filepath, searchText, err := parseArgs(os.Args) if err != nil { t.Errorf(\u0026#34;Expected no error, but got %v\u0026#34;, err) } if filepath != \u0026#34;test.txt\u0026#34; { t.Errorf(\u0026#34;Expected filepath to be \u0026#39;test.txt\u0026#39;, but got %v\u0026#34;, filepath) } if searchText != \u0026#34;hello\u0026#34; { t.Errorf(\u0026#34;Expected searchText to be \u0026#39;hello\u0026#39;, but got %v\u0026#34;, searchText) } // æµ‹è¯•å‚æ•°æ•°é‡é”™è¯¯çš„æƒ…å†µ os.Args = []string{\u0026#34;minigrep\u0026#34;, \u0026#34;test.txt\u0026#34;} _, _, err = parseArgs(os.Args) if err == nil { t.Error(\u0026#34;Expected error for incorrect number of arguments, but got none\u0026#34;) } else if !strings.Contains(err.Error(), \u0026#34;illegal arguments\u0026#34;) { t.Errorf(\u0026#34;Expected error message containing \u0026#39;illegal arguments\u0026#39;, but got \u0026#39;%v\u0026#39;\u0026#34;, err) } } // TestSearchFile æµ‹è¯•åœ¨æ–‡ä»¶å†…å®¹ä¸­æœç´¢æ–‡æœ¬çš„åŠŸèƒ½ func TestSearchFile(t *testing.T) { // æµ‹è¯•åŒ…å«æœç´¢æ–‡æœ¬çš„æƒ…å†µ content := \u0026#34;hello world\\nthis is a test\\ngoodbye world\u0026#34; searchText := \u0026#34;hello\u0026#34; expected := \u0026#34;hello world\\n\u0026#34; // é‡å®šå‘æ ‡å‡†è¾“å‡ºä»¥ä¾¿æ•è· r, w, _ := os.Pipe() stdout := os.Stdout os.Stdout = w searchFile(content, searchText) w.Close() os.Stdout = stdout // è¯»å–è¾“å‡º result, _ := io.ReadAll(r) if string(result) != expected { t.Errorf(\u0026#34;Expected output \u0026#39;%s\u0026#39;, but got \u0026#39;%s\u0026#39;\u0026#34;, expected, string(result)) } // æµ‹è¯•ä¸åŒ…å«æœç´¢æ–‡æœ¬çš„æƒ…å†µ content = \u0026#34;hello world\\nthis is a test\\ngoodbye world\u0026#34; searchText = \u0026#34;missing\u0026#34; r, w, _ = os.Pipe() stdout = os.Stdout os.Stdout = w searchFile(content, searchText) w.Close() os.Stdout = stdout // è¯»å–è¾“å‡º result, _ = io.ReadAll(r) if len(result) \u0026gt; 0 { t.Errorf(\u0026#34;Expected no output, but got \u0026#39;%s\u0026#39;\u0026#34;, string(result)) } } // TestReadFile æµ‹è¯•è¯»å–æ–‡ä»¶åŠŸèƒ½ func TestReadFile(t *testing.T) { // åˆ›å»ºä¸´æ—¶æµ‹è¯•æ–‡ä»¶ dir := t.TempDir() testFile := dir + \u0026#34;/test.txt\u0026#34; data := \u0026#34;hello world\\nthis is a test\\ngoodbye world\u0026#34; os.WriteFile(testFile, []byte(data), 0644) // æµ‹è¯•æ­£å¸¸è¯»å–æ–‡ä»¶ content, err := readFile(testFile) if err != nil { t.Errorf(\u0026#34;Expected no error, but got %v\u0026#34;, err) } if content != data { t.Errorf(\u0026#34;Expected content \u0026#39;%s\u0026#39;, but got \u0026#39;%s\u0026#39;\u0026#34;, data, content) } // æµ‹è¯•è¯»å–ä¸å­˜åœ¨çš„æ–‡ä»¶ _, err = readFile(dir + \u0026#34;/nonexistent.txt\u0026#34;) if err == nil { t.Error(\u0026#34;Expected error for nonexistent file, but got none\u0026#34;) } else if !strings.Contains(err.Error(), \u0026#34;file not found\u0026#34;) { t.Errorf(\u0026#34;Expected error message containing \u0026#39;file not found\u0026#39;, but got \u0026#39;%v\u0026#39;\u0026#34;, err) } // æµ‹è¯•è¯»å–ç›®å½• _, err = readFile(dir) if err == nil { t.Error(\u0026#34;Expected error for reading directory, but got none\u0026#34;) } else if !strings.Contains(err.Error(), \u0026#34;is a directory\u0026#34;) { t.Errorf(\u0026#34;Expected error message containing \u0026#39;is a directory\u0026#39;, but got \u0026#39;%v\u0026#39;\u0026#34;, err) } } å¯ä»¥çœ‹åˆ°ï¼šæˆ‘ä»¬çš„ä»£ç é€šè¿‡äº†æµ‹è¯•\n1 2 3 4 5 6 7 8 9 PS D:\\go-project\\minigrep\u0026gt; go test -v === RUN TestParseArgs --- PASS: TestParseArgs (0.00s) === RUN TestSearchFile --- PASS: TestSearchFile (0.00s) === RUN TestReadFile --- PASS: TestReadFile (0.00s) PASS ok minigrep 0.160s ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾å¿ƒå°†è¿™ä¸ªç¨‹åºäº¤ç»™ç”¨æˆ·å»ä½¿ç”¨å•¦ï¼ˆå°½ç®¡åŠŸèƒ½ç®€é™‹ï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬è¦å¦‚ä½•è®©ç”¨æˆ·èƒ½ä½¿ç”¨è¿™ä¸ªç¨‹åºå‘¢ï¼Ÿ\næ‰“åŒ…ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ æˆ‘ä»¬å¯ä»¥ç”¨buildå‘½ä»¤æ‰“åŒ…ä¸ºexeï¼Œä»¥ä¾¿ç”¨æˆ·åœ¨ä¸€ä¸ªæ²¡æœ‰goè¯­è¨€ç¯å¢ƒçš„å‘½ä»¤è¡Œä¸­ä¹Ÿèƒ½ç›´æ¥æ‰§è¡Œ\n1 2 3 4 5 6 // æ‰“åŒ…ä¸ºexe go build -o minigrep.exe // ä½¿ç”¨ç”¨ä¾‹ PS D:\\go-project\\minigrep\u0026gt; .\\minigrep.exe .\\data\\test1.txt åŠŸèƒ½ Go å¯å¿«é€Ÿç¼–è¯‘ä¸ºæœºå™¨ä»£ç ï¼Œä½†å…·æœ‰åƒåœ¾å›æ”¶çš„ä¾¿åˆ©æ€§å’Œè¿è¡Œæ—¶åå°„çš„åŠŸèƒ½ã€‚ æ€»ç»“ é€šè¿‡è¿™ä¸ªç®€çŸ­çš„ç¨‹åºï¼Œæˆ‘ä»¬åˆæ­¥ç†è§£äº†golangä¸­çš„funcã€å¼‚å¸¸å¤„ç†ã€æ–‡ä»¶ç³»ç»Ÿã€èµ‹å€¼ã€æµç¨‹æ§åˆ¶ã€å­—ç¬¦ä¸²å¤„ç†ç­‰åŸºç¡€è¯­æ³•ã€‚ç„¶è€Œï¼Œå¾ˆå¤šgolangçš„ç‰¹æ€§ã€è¯­æ³•æˆ‘ä»¬éƒ½æ²¡æœ‰æ¶‰åŠã€‚æ­¤å¤–ï¼Œè¿™ä¸ªminigrepç”šè‡³ä¸èƒ½ç§°ä¹‹ä¸ºç©å…·ï¼ŒåŠŸèƒ½ç®€é™‹è‡³æã€‚å› æ­¤ï¼Œåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šé€æ­¥æ‹“å±•åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿä¼šæ¶‰åŠæ›´å¤šæ–°è¯­æ³•ã€‚\n","date":"2025-05-01T00:00:00Z","permalink":"http://localhost:1313/p/%E4%BA%94%E5%A4%A9%E9%80%9F%E9%80%9Ago%E4%B8%80--%E6%90%AD%E5%BB%BAmini-grep/","title":"äº”å¤©é€Ÿé€šgo(ä¸€)--æ­å»ºmini-grep"},{"content":"2 åº”ç”¨å±‚ 2.1 Webå’ŒHttp å¯¹httpè¿™ä¸€å¥—è¿˜æ˜¯éå¸¸äº†è§£çš„äº†ã€‚ è¿™èŠ‚è¯¾å¤§è‡´è¯´äº†è¯·æ±‚å¤´ã€å»ºç«‹è¿æ¥è¿‡ç¨‹ã€Cookieç­‰ è¿™æ˜¯ä¸€äº›ä¹‹å‰æ²¡æ³¨æ„çš„ç»†èŠ‚ï¼š http1.0åªæœ‰POSTå’ŒGETï¼ŒHttp1.1æœ‰PUTã€DELETE åé¢è¿˜è®²äº†ä¸€äº›æœåŠ¡å™¨ç¼“å­˜ï¼Œæ¶‰åŠåˆ°äº†ä¸€ä¸ªåœºæ™¯çš„æ€§èƒ½æå‡è®¡ç®—ï¼Œè¿‡äºç»†èŠ‚æ²¡æœ‰ç‰¹åˆ«å…³æ³¨ã€‚ ä»‹ç»äº†ç¼“å­˜çš„æœºåˆ¶ï¼ˆæ ¹æ®æ—¶é—´æ¥åˆ¤æ–­æ˜¯å¦æ‹‰æ–°çš„ï¼ŒçŠ¶æ€ç 304ã€200ï¼‰\n2.2 FTP å¤§æ¦‚ä»‹ç»äº†ä¸€ä¸‹ï¼Œå®¢æˆ·ç«¯å…ˆå’ŒæœåŠ¡æ–­å»ºç«‹æ§åˆ¶è¿æ¥ï¼Œç”¨äºè´¦å·å¯†ç æ ¡éªŒã€æ§åˆ¶åˆ‡æ¢ç›®å½•ç­‰ï¼Œä¹‹åå†å»ºç«‹æ•°æ®è¿æ¥ï¼Œç”¨äºæ–‡ä»¶ä¼ è¾“\n2.3 2.7 TCPå¥—æ¥å­—ç¼–ç¨‹ ä¸»è¦è¯´äº†apiå®ç°\næœåŠ¡ç«¯ï¼š1.åˆ›å»ºwelcome socketï¼Œ2ç»‘å®šäº†æœ¬åœ°ç«¯å£ã€ipï¼›3.acceptç­‰å¾…å®¢æˆ·ç«¯è¿æ¥\nå®¢æˆ·ç«¯ï¼š1.åˆ›å»ºsocketï¼ˆæ“ä½œç³»ç»Ÿé»˜è®¤éšå¼ç»‘å®šæœ¬åœ°ipç«¯å£ï¼‰2.connectè¿æ¥æœåŠ¡ç«¯ï¼Œç»‘å®šæœåŠ¡ç«¯ipç«¯å£\næœåŠ¡ç«¯ï¼šæ”¶åˆ°å»ºç«‹è¯·æ±‚åï¼Œå°±ä¼šå†å»ºä¸€ä¸ªæ–°çš„socketæ¥ç»‘å®šæœ¬åœ°ã€å¯¹æ–¹ipç«¯å£\nä¹‹åå°±æ˜¯å®¢æˆ·ç«¯wirteã€æœåŠ¡ç«¯readï¼ŒæœåŠ¡ç«¯writeï¼Œå®¢æˆ·ç«¯read\nä¹‹åå°±æ˜¯close\n3.1 Ipåè®®æ˜¯ä¸»æœºå’Œä¸»æœºä¹‹é—´çš„é€šä¿¡\nTCPã€UDPæ˜¯è¿›ç¨‹å’Œè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡\nTCPä¼ è¾“çš„æ˜¯æ•°æ®æµï¼Œæ²¡æœ‰æ•°æ®è¾¹ç•Œï¼›UDPä¼ è¾“çš„æ˜¯æ•°æ®æŠ¥datagramï¼Œæ¯ä¸ªæ¶ˆæ¯éƒ½æ˜¯ç‹¬ç«‹å®Œæ•´çš„æ•°æ®æŠ¥\nTCPåœ¨ipåŸºç¡€ä¸Šå¢å¼ºäº†ä»¥ä¸‹èƒ½åŠ›ï¼šæ›´å¯é ã€æ‹¥å¡æµé‡æ§åˆ¶ã€è€ŒUDPåˆ™æ²¡æœ‰åœ¨ipåŸºç¡€ä¸Šæå‡èƒ½åŠ›ï¼ˆTCPã€UDPéƒ½åšäº†å¤šè·¯å¤ç”¨è§£å¤ç”¨ï¼‰ ä½†æ˜¯ä»–ä»¬éƒ½ä¸èƒ½æå‡å¸¦å®½ã€é™ä½å»¶è¿Ÿ\n3.2å¤šè·¯å¤ç”¨ã€è§£å¤ç”¨ ä»–ä»¬å¦‚ä½•åœ¨è¿›ç¨‹ä¸­é€šä¿¡ï¼ŸTCPï¼ˆæºå¸¦çš„socketåŒ…å«äº†åŸipç›®æ ‡ipï¼ŒåŸportã€ç›®æ ‡portï¼‰ä¼šæºå¸¦åŸportã€ç›®æ ‡portï¼›ipä¼šæºå¸¦åŸipã€ç›®æ ‡ipï¼Œå› æ­¤å½“å¯¹æ–¹æ”¶åˆ°tcp segmentåï¼Œè‡ªç„¶èƒ½é€šè¿‡è¿™å››ä¸ªä¿¡æ¯å»æŸ¥åˆ°å¯¹åº”çš„socketå’Œpidï¼›è€ŒUDPåªæºå¸¦äº†socketï¼ˆåŸipã€åŸportï¼‰å’Œcadï¼ˆå¯¹æ–¹ipã€å¯¹æ–¹protï¼‰ï¼›é™¤æ­¤ä¹‹å¤–ï¼Œå½“ç„¶ä»–ä»¬éƒ½æºå¸¦äº†æ•°æ®msg\n3.3 æ— è¿æ¥UDP UDP ï¼ˆuser datagram protocolï¼‰å› ä¸ºåªåœ¨å‘é€ã€æ¥å—æ—¶è¿›è¡Œäº†ç®€å•çš„æ ¡éªŒè¿ç®—ï¼Œæ‰€ä»¥ä¼ è¾“é€Ÿåº¦å¾ˆå¿«ï¼Œæ²¡æœ‰æä¾›å…¶ä»–é«˜çº§ç‰¹æ€§\nä¸ºä»€ä¹ˆUDP çš„å·®é”™æ ¡éªŒæœºåˆ¶ä½¿ç”¨äº†è¿™æ ·ä¸€ä¸ªå¤æ‚çš„æœºåˆ¶ï¼Ÿ\nå‡è®¾é‡‡ç”¨ä¸€ç§æ›´ç®€å•çš„æ–¹å¼ï¼šå‘é€ç«¯å°†æ‰€æœ‰æ•°æ®æ¯16ä½è¿›è¡Œè¡¥å’Œè¿ç®—ï¼Œå°†ç»“æœæ”¾åœ¨ä¸€ä¸ªæ–°çš„æ•°æ®æ®µä¸­ï¼ˆå‡è®¾å«æ ¡éªŒç ï¼‰ï¼Œç„¶åæ¥æ”¶ç«¯å†åŒæ ·å°†æ‰€æœ‰æ•°æ®æ¯16ä½è¿›è¡Œè¡¥å’Œè¿ç®—ï¼Œå¦‚æœç»“æœç­‰äºæ ¡éªŒï¼Œåˆ™è¡¨æ˜æ²¡æœ‰å‡ºé”™ã€‚è¿™æ ·çš„æ–¹æ¡ˆæ˜æ˜¾æ˜¯ä¸å……è¶³çš„ï¼Œå®¹æ˜“å¼•èµ·è¯¯åˆ¤ ä¸ºä»€ä¹ˆå°†æ•°æ®éƒ¨åˆ†æ¯16ä½è¿›è¡Œè¡¥å’Œè¿ç®—ï¼ˆé‡‡ç”¨è¿›ä½å›æ»šçš„ç›¸åŠ å¹¶å–åï¼‰ï¼Œç„¶åä¸æ ¡éªŒç è¿›è¡Œç›¸åŠ ï¼Œä¸€å®šä¼šç­‰äºFFFFï¼Ÿ\nå°†æ•°æ®éƒ¨åˆ†æ¯16ä½è¿›è¡Œè¡¥å’Œè¿ç®—ï¼ˆé‡‡ç”¨è¿›ä½å›æ»šçš„ç›¸åŠ å¹¶å–åï¼‰ï¼Œç„¶åä¸æ ¡éªŒç è¿›è¡Œç›¸åŠ ï¼Œå¦‚æœç­‰äºFFFFå°±æ²¡æœ‰å‡ºé”™ï¼Ÿ\nå› ä¸ºæ ¡éªŒç æ˜¯\nå› ä¸ºè¿™æ ·å¯ä»¥æœ€å¤§åŒ–ä¿è¯æ ¡éªŒæ˜¯æœ‰æ•ˆä¸”å¿«é€Ÿçš„ï¼Ÿ\n3.4å¯é æ•°æ®ä¼ è¾“RDP RDP ï¼šreliable datagram protocol\nRDP1.0ï¼š è¿™æ˜¯ä¸€ç§åè®®å‡è®¾ï¼Œå‡è®¾æ¶ˆæ¯æ—¢ä¸ä¸¢å¤±ä¹Ÿä¸å‡ºé”™ï¼Œè¿™æ ·åªéœ€è¦å‘é€æ–¹ä¸åœå‘é€æ¶ˆæ¯ï¼Œæ¥æ”¶æ–¹ä¸åœæ¥å—æ¶ˆæ¯å³å¯\nRDP2.0 å‡è®¾æ­¤åè®®ä¸‹ï¼Œæ¶ˆæ¯ä¼šå‘ç”Ÿé”™è¯¯ï¼Œå› æ­¤éœ€è¦åè®®è§£å†³é”™è¯¯\nä¸å‡ºé”™æƒ…å†µä¸‹ï¼šæ¶ˆæ¯å‘é€æ–¹å‘é€æ¶ˆæ¯ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°æ¶ˆæ¯åï¼Œé€šè¿‡æ ¡éªŒï¼Œå‘ç°æ¶ˆæ¯æœªå‡ºé”™ï¼Œåˆ™è¿”å›ack\nå‡ºé”™äº†ï¼šæ¥æ”¶æ–¹è¿”å›nackï¼Œåˆ™å‘é€æ–¹å†æ¬¡å‘é€æ¶ˆæ¯1\nRDP2.1 å‘é€çš„æ¶ˆæ¯ä¼šå‡ºé”™ï¼Œè¿”å›çš„æ¶ˆæ¯ä¹ŸåŒæ ·ä¼šå‡ºé”™\nå‡å¦‚å‘é€æ–¹æ”¶åˆ°äº†æ¥æ”¶æ–¹è¿”å›çš„å‡ºé”™çš„æ¶ˆæ¯ï¼ˆå³æ— æ³•è¯†åˆ«çš„æ¶ˆæ¯ï¼‰ï¼Œåˆ™é»˜è®¤æ˜¯nackï¼Œå³é»˜è®¤å‘é€å‡ºé”™ï¼Œå†æ¬¡å‘é€0å·æ¶ˆæ¯ï¼Œæ¥å—æ–¹æ¥å—ä»¥åï¼Œè¿”å›ack0ï¼Œå‘é€æ–¹å°±ç»§ç»­å‘é€msg1ã€‚å¦‚æœå®é™…ä¸Šæ²¡æœ‰å‡ºé”™ï¼Œåˆ™æ¥æ”¶æ–¹ä¸¢å¼ƒæ­¤æ¬¡æ¶ˆæ¯å³å¯\nRDP2.2 å¯¹2.1è¿›è¡Œå°ä¼˜åŒ–ï¼Œä¸å‘é€NACKäº†ï¼Œå¦‚æœå‡ºé”™ï¼Œè¿”å›ä¸Šä¸€æ¡æ¶ˆæ¯çš„ACKï¼Œæ¯”å¦‚1å·æ¶ˆæ¯å‡ºé”™ï¼Œè¿”å›ACK0\nRDP3.0 æ­¤åè®®ä¸‹ï¼Œæ¶ˆæ¯ä¼šä¸¢å¤±\nå› æ­¤å¼•å…¥è¶…æ—¶é‡å‘æœºåˆ¶ï¼Œå‡å¦‚å‘é€æ¶ˆæ¯åä¸€æ®µæ—¶é—´åï¼Œæ²¡æœ‰è¿”å›ackï¼Œåˆ™è¯´æ˜æ¶ˆæ¯ä¸¢å¤±ï¼Œå†æ¬¡å‘é€å³å¯ï¼Œå‡å¦‚å®é™…æ²¡ä¸¢å¤±ï¼Œåªæ˜¯é«˜å»¶è¿Ÿï¼Œåˆ™æ¥æ”¶æ–¹æ”¶åˆ°æ¶ˆæ¯ä¸¢å¼ƒå³å¯\n3.5TCP æŠ¥æ–‡ç»“æ„ ipã€ç«¯å£ã€åºå·ã€ç¡®è®¤å·ï¼ˆåºå·å’Œç¡®è®¤å·éƒ½å€¼å¾—æ˜¯ä¸Šå±‚ä¸‹æ¥çš„æ•°æ®çš„æ•°æ®åç§»é‡ï¼‰ã€ä¸€äº›ä¸å¸¸ç”¨çš„æ ‡å¿—ä½ã€ä»¥åŠbody\nç”±äºæ˜¯å…¨åŒå·¥ï¼Œæ‰€ä»¥è¿”å›ackçš„æ—¶å€™ç”¨åˆ°äº†ç¡®è®¤å·ï¼Œç©ºä½™é‡ï¼ˆç”¨äºæµé‡æ§åˆ¶ï¼‰ï¼ŒåŒæ—¶ä¹Ÿæœ‰éœ€è¦è¿”å›çš„çœŸæ­£çš„æ•°æ®\nå¦‚ä½•æ§åˆ¶è¶…æ—¶é‡ä¼ ï¼Ÿ\nå‘é€ç¬¬ä¸€æ®µæ•°æ®åå¯åŠ¨timerï¼Œè®°å½•è¿”å›æ—¶é—´ã€‚é€šè¿‡è®¡ç®—ç±»ä¼¼äºå¹³å‡å€¼ä¸å››å€æ–¹å·®çš„æ—¶é—´æ¥åŠ¨æ€è®¡ç®—è¶…æ—¶æ—¶é—´ã€‚\nTCPæ˜¯ç´¯è®¡ç¡®è®¤çš„ã€‚\ntcpæé«˜æ€§èƒ½çš„æ–¹æ³•\n1.å»¶è¿Ÿç¡®è®¤ï¼ˆåœ¨æŸä¸ªtimerå†…ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ªæ®µæ•°æ®åˆ°æ¥ï¼Œåˆå¹¶ç¡®è®¤ï¼Œå¯ä»¥å‡å°‘ä¼ è¾“åŠå¹²æ‰° æˆ–è€…åœ¨timerå†…éƒ½æ²¡æ”¶åˆ°æ¶ˆæ¯ï¼Œåˆ™è¿”å›å·²ç»åˆ°çš„ackï¼‰\n2.ä¹±åºç¡®è®¤åˆ™ç«‹å³è¿”å›ackä¸Šä¸€æ®µ\n3.ï¼ˆå¿«é€Ÿé‡ä¼ ï¼‰å¦‚æœè¶…æ—¶æˆ–æ”¶åˆ°ä¸‰ä¸ªå†—ä½™ç¡®è®¤ï¼Œåˆ™é‡å‘ï¼ˆè¯´æ˜åä¸‰æ®µéƒ½å·²ç»åˆ°äº†ï¼Œä½†æ˜¯æ‰€æœŸå¾…çš„æ®µæœªackï¼Œåˆ™å¿«é€Ÿé‡ä¼ ï¼‰\næµé‡æ§åˆ¶ï¼š\nè¿”å›ACKæ—¶é¡ºä¾¿å¸¦ä¸Šç¼“å†²åŒºå¤§å°\n","date":"2025-05-01T00:00:00Z","permalink":"http://localhost:1313/p/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B8%AD%E7%A7%91%E5%A4%A7%E9%83%91%E7%83%87--%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","title":"è®¡ç®—æœºç½‘ç»œ(ä¸­ç§‘å¤§éƒ‘çƒ‡)--ä¸ªäººå­¦ä¹ ç¬”è®°"},{"content":"Kafkaè¦è§£å†³çš„é—®é¢˜ï¼š åŸè§†é¢‘ï¼š\nã€æ¶ˆæ¯é˜Ÿåˆ—Kafkaæ˜¯ä»€ä¹ˆï¼Ÿæ¶æ„æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ5åˆ†é’Ÿå¿«é€Ÿå…¥é—¨ã€‘https://www.bilibili.com/video/BV1TT421y79S?vd_source=f2fbf19a95f21a30c8f56673d2b182b7\næ¶ˆè´¹è€…ä¸ç”Ÿäº§è€…ä¹‹é—´çš„ç”Ÿäº§é€Ÿåº¦å’Œæ¶ˆè´¹é€Ÿåº¦æ˜¯ä¸åŒ¹é…çš„ã€‚å¦‚æœç”Ÿäº§çš„æ¶ˆæ¯éƒ½å¾€æ¶ˆè´¹è€…å¡ï¼Œé‚£ä¹ˆæ¶ˆè´¹è€…å¾ˆå®¹æ˜“æŒ‚æ‰ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠæ¶ˆæ¯å‘å¾€ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ã€‚æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥èµ·åˆ° 1å‰Šå³°å¡«è°· 2.è§£è€¦ 3.å¼‚æ­¥ ç­‰ä½œç”¨ã€‚ä½†å¦‚æœæ¶ˆæ¯é˜Ÿåˆ—ä¸æ¶ˆè´¹è€…è€¦åˆï¼Œä¼šæœ‰å¾ˆå¤šé—®é¢˜ã€‚äºæ˜¯éœ€è¦æŠŠæ¶ˆæ¯é˜Ÿåˆ—æŠ½è±¡å‡ºæ¥ï¼Œè€ŒKafkaå°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸€ç§ä¸­é—´ä»¶ã€‚\néšç€æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…çš„å¢åŠ ï¼Œæ¶ˆæ¯çš„ååå¢åŠ äº†ã€‚ç„¶è€Œååé‡åˆ°è¾¾ä¸€å®šç¨‹åº¦ï¼Œé‚£ä¹ˆå¤šä¸ªæ¶ˆè´¹è€…/ç”Ÿäº§è€…å°±ä¼šå…±åŒäº‰æŠ¢ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¼šæœ‰ç­‰å¾…æ—¶é—´ã€‚è¿™æ ·å°±å‡ºç°äº†æ€§èƒ½é—®é¢˜ã€‚é‚£ä¹ˆè¿™æ—¶å€™å°±å¯ä»¥å¢åŠ æ¶ˆæ¯é˜Ÿåˆ—ï¼ŒæŒ‡å®šä¸åŒç§ç±»çš„æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…ä½¿ç”¨æŸä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—\u0026ndash;è¿™ä¸ªå°±æ˜¯topicã€‚å•ä¸ªtopicæ•°æ®é‡è¿‡å¤§æ—¶ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†å•ä¸ªtopicæ‹†å¼€ï¼Œè¿™å°±æ˜¯partitionï¼Œç„¶åæ¯ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ä¸åŒpartitionã€‚\nå¦‚æœå¤šä¸ªpartitionéƒ½æ”¾åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œåˆ™ä¼šå¯¹æœºå™¨é€ æˆæ€§èƒ½å‹åŠ›ï¼Œé‚£ä¹ˆå¯ä»¥å°†ä¸åŒpartitionæ”¾åœ¨ä¸åŒæœºå™¨ä¸Šï¼Œé‚£ä¹ˆæ¯ä¸ªæœºå™¨å°±æ˜¯ä¸€ä¸ªborkerã€‚\nå¦‚æœbrokerçš„æœºå™¨æŒ‚æ‰äº†ï¼Œé‚£ä¹ˆæ•°æ®å°±å…¨ä¸¢äº†ã€‚ä¸ºäº†åšåˆ°é«˜å¯ç”¨æ€§ï¼Œå¾€å¾€å°†partitionåšå¤‡ä»½å³å‰¯æœ¬replicasã€‚\nleaderè´Ÿè´£è¯»å†™ã€followerè´Ÿè´£åŒæ­¥leaderã€‚ä¸ºäº†ä»¥é˜²ä¸‡ä¸€ï¼Œå¾€å¾€è¿˜ä¼šå¯¹æ•°æ®è¿›è¡ŒæŒä¹…åŒ–ã€‚å°†æ•°æ®å†™åˆ°ç£ç›˜ä¸Šï¼Œç„¶åæ ¹æ®æŸç§ç­–ç•¥æ¸…ç†ç£ç›˜\næ¶ˆè´¹ç»„ consumer groupç›¸å…³æ¦‚å¿µ æ¶ˆè´¹ç»„æ˜¯ä¸ºäº†è§£å†³ï¼šå•ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹é€Ÿåº¦è·Ÿä¸ä¸Šç”Ÿäº§è€…ï¼Œé‚£ä¹ˆå°±å¢åŠ å¤šä¸ªæ¶ˆè´¹è€…ç»„æˆæ¶ˆè´¹ç»„æ¥å…±åŒæ¶ˆè´¹æŸä¸ªtopicã€‚\nkafkaæ§åˆ¶äº†åœ¨ä¸€ä¸ªæ¶ˆè´¹ç»„ä¸­ï¼Œï¼ŒåŒä¸€ Partition å†…çš„æ¶ˆæ¯åœ¨åŒä¸€ä¸ª Consumer Group ä¸­åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…å®ä¾‹å¤„ç†ã€‚è€Œä¸åŒæ¶ˆè´¹ç»„ä¹‹é—´æ˜¯å¯ä»¥ç‹¬ç«‹çš„æ¶ˆè´¹åŒä¸€æ¡æ¶ˆæ¯ã€‚\næ¶ˆè´¹ç»„è®¢é˜…çš„æ˜¯topicï¼Œè®¢é˜…åï¼Œè°ƒåº¦è€…coordinateå°±ä¼šå°†ä¸åŒpartitionåˆ†é…ç»™ä¸åŒæ¶ˆè´¹è€…å®ä¾‹ã€‚è°ƒåº¦å‘˜coordinateä¼šåœ¨æ¶ˆè´¹è€…å¢å‡ã€partitionå¢å‡ã€æ¶ˆè´¹ç»„è®¢é˜…æ–°topicæ—¶è¿›è¡Œé‡æ–°åˆ†é…rebalanceã€‚rebalanceæ—¶groupä¸­çš„æ‰€æœ‰æ¶ˆè´¹è€…ä¼šæš‚åœæ¶ˆè´¹è‡³é‡æ–°åˆ†é…å®Œæ¯•\nç”Ÿäº§è€…çš„æ ¸å¿ƒæœºåˆ¶ æ¶ˆæ¯åˆ†å‘ç­–ç•¥ï¼šç”Ÿäº§è€…è¦æŒ‡å®štopicï¼Œé‚£ä¹ˆè¿›å…¥topicçš„æ¶ˆæ¯åº”è¯¥å»å“ªä¸ªpartitionï¼Ÿè¿™æœ‰ä¸åŒç­–ç•¥ï¼Œæ¯”å¦‚è½®è¯¢åˆ†é…ï¼Œæ¯”å¦‚æŒ‰æŸä¸ªè§„åˆ™hashåˆ†é…ã€‚\nACKæœºåˆ¶ï¼šå¯ä»¥ä¸ç¡®è®¤ï¼ˆacks=0ï¼‰ã€leaderç¡®è®¤ï¼ˆacks=1ï¼‰ã€leaderåŠfollowerç¡®è®¤ï¼ˆacks=allï¼‰\nacks=allæ—¶ï¼Œè¿˜æœ‰ä¸€ä¸ªå‚æ•°min.insync.replicaså³isrçš„å‰¯æœ¬å¤§äºç­‰äºè¿™ä¸ªå‚æ•°æ—¶ï¼Œå°±å¯ä»¥å‘ç”Ÿäº§è€…è¿”å›ack\né«˜æ°´ä½çº¿ high watermarkæœºåˆ¶ hwæ ‡è®°äº†ä¸€ä¸ªä½ç½®\u0026ndash;æ‰€æœ‰å‰¯æœ¬éƒ½å·²ç»åŒæ­¥çš„æ¶ˆæ¯offsetä½ç½®ï¼Œæ¶ˆè´¹è€…åªèƒ½è¯»å–åˆ°å°äºhwçš„æ¶ˆæ¯\nAIç”»çš„å›¾ï¼š\nOffset 0 1 2 3 4 5 6 æ¶ˆæ¯ A B C D E F G çŠ¶æ€ âœ… âœ… âœ… âœ… ğŸš« ğŸš« ğŸš« 1 2 â†‘ HW=4 (å®‰å…¨æ°´ä½çº¿) æ­¤æ—¶å½“æ‰€æœ‰followerç¡®è®¤æ¶ˆæ¯EæŒä¹…åŒ–åï¼ŒHWå°±ä¼šæ›´æ–°ä¸º5\nHWåªç”±Leaderè¿›è¡Œæ›´æ–°ç»´æŠ¤ï¼Œä¼šç”±kafkaçš„å„ç§å¼ºåˆ¶åˆ·ç›˜æœºåˆ¶å†™åˆ°ç£ç›˜ä¸Š\nç–‘é—®ï¼š\n1.ä¸ºä»€ä¹ˆæœ‰topicå’Œpartitionçš„æ¦‚å¿µï¼Œç›´æ¥æ–°å¢æ¶ˆæ¯é˜Ÿåˆ—ä¸å°±è¡Œäº†ï¼Ÿ\n2.å‡å¦‚å‰¯æœ¬flowerå°šæœªæ‹‰å–åŒæ­¥å®Œleaderçš„æ¶ˆæ¯ï¼ŒleadæŒ‚æ‰äº†ï¼Œæ­¤æ—¶é€‰ä¸¾å‡ºæ¥çš„leaderå²‚ä¸æ˜¯ä¼šä¸¢æ¶ˆæ¯ï¼Ÿ\nè¿™æ˜¯AIç»™çš„åœºæ™¯å¤ç°ï¼š\nåˆå§‹çŠ¶æ€\nTopic åˆ†åŒºÂ P0Â æœ‰ 3 ä¸ªå‰¯æœ¬ï¼šLeader L1ï¼ŒFollower F2ï¼ŒFollower F3ï¼ˆISR = [L1, F2, F3]ï¼‰\nç”Ÿäº§è€…å‘é€æ¶ˆæ¯Â M1Â åˆ°Â L1ï¼ŒL1Â å°†Â M1Â å†™å…¥æœ¬åœ°æ—¥å¿—ï¼ˆä½†å°šæœªåŒæ­¥ç»™ Followerï¼‰\næ•…éšœå‘ç”Ÿ\nL1Â çªç„¶å®•æœºï¼ˆæ­¤æ—¶Â M1Â æœªåŒæ­¥ç»™ä»»ä½• Followerï¼‰\nç³»ç»Ÿéœ€é€‰ä¸¾æ–° Leaderï¼ˆF2Â æˆ–Â F3ï¼‰\né£é™© è‹¥é€‰å‡ºçš„æ–° Leader æ˜¯Â F2Â æˆ–Â F3ï¼Œå®ƒä»¬ä»æœªæ”¶åˆ°è¿‡Â M1ï¼Œå¯¼è‡´Â M1Â æ°¸ä¹…ä¸¢å¤±ï¼\nè§£å†³æ–¹æ¡ˆï¼š1ã€ACKç­–ç•¥æŒ‡å®šall åˆ™åªè¦ç”Ÿäº§è€…ç¡®è®¤æˆåŠŸï¼Œé‚£æ‰€æœ‰å‰¯æœ¬éƒ½æœ‰æ•°æ®ï¼Œä¸ä¼šä¸¢å¤±\nå‡å¦‚acks=1ï¼Œé‚£ä¹ˆåœ¨æ­¤åœºæ™¯ä¸­ï¼Œ\nLeader (L) å·²å†™å…¥æ¶ˆæ¯ E (Offset=4)\nF1 åŒæ­¥äº† E â†’ ISR = [L, F1, F2]\nF2Â æœªåŒæ­¥ Eï¼ˆå› ç½‘ç»œå»¶è¿Ÿï¼‰\næ­¤æ—¶ HW ä»ä¸º 4ï¼ˆå›  F2 æœªç¡®è®¤ï¼Œæ¶ˆæ¯ E ä¸ç®—å®‰å…¨ï¼‰\nçªå‘æ•…éšœï¼šLeader (L) å®•æœºï¼\nF1è¢«é€‰ä¸¾ä¸ºLeaderï¼Œä¼šè¿›è¡Œæ£€æŸ¥ï¼Œå‘ç°HW=4ï¼Œåˆ™å°†æ¶ˆæ¯Eä¸¢å¼ƒã€‚è€ŒF2æ£€æŸ¥åä¸åšå¤„ç†ã€‚ç„¶åå°±æ˜¯æ­£å¸¸çš„åŒæ­¥æ•°æ®æµç¨‹\nTODOï¼šé¦–å…ˆç¡®è®¤è¿™ä¸ªç†è§£ï¼Œç„¶ååœ¨è¿™ç§åœºæ™¯ä¸­ï¼Œæ˜¯ä¸æ˜¯æ­¤æ—¶ç”Ÿäº§è€…ä¼šå¾—åˆ°æ¶ˆæ¯å‘é€å¤±è´¥çš„åé¦ˆï¼Œä»è€Œåœ¨replicasæ¢å¤æ­£å¸¸åï¼Œå†ç»§ç»­å‘é€ä¸€æ¬¡æ¶ˆæ¯Eï¼Ÿä»è€Œä¿è¯å‘é€çš„æ¶ˆæ¯Eä¸ä¼šä¸¢å¤±\n","date":"0001-01-01T00:00:00Z","permalink":"http://localhost:1313/p/","title":""}]